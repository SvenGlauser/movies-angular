<div class="content">
  <div class="left" *ngIf="(hasPersons() || hasMovies() || hasTVs()) && chargement === 0 || chargement !== 0">
    <section class="filter">
      <h2>Filtres</h2>
      <mat-button-toggle-group [formControl]="filter" [name]="'filter'" aria-label="Result type">
        <mat-button-toggle (change)="movies?.page !== 1 ? searchMovie() : true" [value]="'movie'" *ngIf="hasMovies()">Films</mat-button-toggle>
        <mat-button-toggle (change)="tvs?.page !== 1 ? searchTV() : true" [value]="'tv'" *ngIf="hasTVs()">Séries</mat-button-toggle>
        <mat-button-toggle (change)="persons?.page !== 1 ? searchPerson() : true" [value]="'person'" *ngIf="hasPersons()">Personnes</mat-button-toggle>
      </mat-button-toggle-group>
    </section>
  </div>
  <div class="right">
    <section class="search">
      <mat-form-field appearance="fill" color="primary" (change)="isValidSearchString(search.value) ? router.navigate(['/'], {queryParams: {search: search.value}}) : router.navigate(['/'])">
        <mat-label>Rechercher</mat-label>
        <input #search matInput placeholder="Film, série ou une personne" [formControl]="searchValue" autocomplete="off" autofocus>
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </section>
    <app-chargement *ngIf="chargement; else content"></app-chargement>
    <ng-template #content>
      <section class="filter" *ngIf="hasPersons() || hasMovies() || hasTVs()">
        <mat-button-toggle-group [formControl]="filter" [name]="'filter'" aria-label="Result type">
          <mat-button-toggle (select)="movies?.page !== 1 ? searchMovie() : true" [value]="'movie'" *ngIf="hasMovies()">Films</mat-button-toggle>
          <mat-button-toggle (select)="tvs?.page !== 1 ? searchTV() : true" [value]="'tv'" *ngIf="hasTVs()">Séries</mat-button-toggle>
          <mat-button-toggle (select)="persons?.page !== 1 ? searchPerson() : true" [value]="'person'" *ngIf="hasPersons()">Personnes</mat-button-toggle>
        </mat-button-toggle-group>
      </section>
      <section class="result">
        <div [ngSwitch]="filter.value" *ngIf="persons !== undefined && tvs !== undefined && movies !== undefined; else trending">
          <ng-container *ngSwitchCase="'movie'">
            {{movies.total_results}} résultats pour « {{searchedValue}} »
            <app-movie *ngFor="let movie of movies.results" [movie]="movie" [routerLink]="['/view/movie/' + movie.id]"></app-movie>
            <mat-paginator *ngIf="hasMovies()" [pageSize]="20" [pageIndex]="movies.page-1" [length]="movies.total_results" (page)="searchMovie($event.pageIndex+1)"></mat-paginator>
          </ng-container>
          <ng-container *ngSwitchCase="'tv'">
            {{tvs.total_results}} résultats pour « {{searchedValue}} »
            <app-tv *ngFor="let tv of tvs.results" [tv]="tv" [routerLink]="['/view/tv/' + tv.id]"></app-tv>
            <mat-paginator *ngIf="hasTVs()" [pageSize]="20" [pageIndex]="tvs.page-1" [length]="tvs.total_results" (page)="searchTV($event.pageIndex+1)"></mat-paginator>
          </ng-container>
          <ng-container *ngSwitchCase="'person'">
            {{persons.total_results}} résultats pour « {{searchedValue}} »
            <app-person *ngFor="let person of persons.results" [person]="person" [routerLink]="['/view/person/' + person.id]"></app-person>
            <mat-paginator *ngIf="hasPersons()" [pageSize]="20" [pageIndex]="persons.page-1" [length]="persons.total_results" (page)="searchPerson($event.pageIndex+1)"></mat-paginator>
          </ng-container>
          <ng-container *ngIf="!hasPersons() && !hasMovies() && !hasTVs()">
            <h3 class="aucun-resultat">Aucun résultat</h3>
          </ng-container>
        </div>
        <ng-template #trending>
          <div class="result">
            <ng-container *ngFor="let trending of getTrending()">
              <app-movie *ngIf="trending.media_type === 'movie'" [movie]="mapToMovie(trending)" [routerLink]="['/view/movie/' + trending.id]"></app-movie>
              <app-tv *ngIf="trending.media_type === 'tv'" [tv]="mapToTv(trending)" [routerLink]="['/view/tv/' + trending.id]"></app-tv>
            </ng-container>
          </div>
        </ng-template>
      </section>
    </ng-template>
  </div>
</div>
